# Overview #

This document is targeted at current [legstar-schemagen](http://www.legsem.com/legstar/legstar-schemagen/index.html) users. legstar-schemagen is the [LegStar](http://www.legsem.com/legstar) module in charge of translating COBOL structures to XML Schema.

legstar-cob2xsd also translates COBOL structures to XML Schema. It has several options that ensure the XML schema produced is compatible with LegStar 1.2.6.

Eventually, legstar-cob2xsd will replace legstar-schemagen.

legstar-cob2xsd is a standalone utility. The intent is that it stays independent from the rest of LegStar.

The most obvious difference with legstar-schemagen is that legstar-cob2xsd is written entirely in Java. legstar-schemagen was mostly C. The C modules in legstar-schemagen are the source of additional complexity. For instance DLLs have to be compiled specifically for each target OS and need to be loaded using OS specific mechanisms.

A more subtle difference is that legstar-cob2xsd uses [ANTLR](http://www.antlr.org/) grammars to parse COBOL structures, while legstar-schemagen is hand coded. The XML Schema produced is generated using [Apache XmlSchema](http://ws.apache.org/commons/XmlSchema/).

# Details #

The XML Schema produced will often look different from the one legstar-schemagen generates. This is a list of differences:

  * No more xs: prefix for XML Schema elements, XML Schema is the default namespace (unless there is no target namespace).

  * By default, element names start with a lowercase character (Complex type names start with uppercase). However, a backward compatibility  option[setElementNamesStartWithUppercase](http://www.legsem.com/legstar/legstar-cob2xsd/apidocs/com/legstar/cob2xsd/Cob2XsdModel.html#setElementNamesStartWithUppercase(boolean)setElementNamesStartWithUppercase) exist to restore a legstar-schemagen behavior.

  * By default, complex type name conflicts are resolved by appending COBOL file source line (same as legstar-schemagen). But there is a new [setNameConflictPrependParentName](http://www.legsem.com/legstar/legstar-cob2xsd/apidocs/com/legstar/cob2xsd/Cob2XsdModel.html#setNameConflictPrependParentName(boolean)) option, to prepend the parent Complex Type name instead.

  * Most numeric elements have a totalDigits facet now. Previously, only decimals with fractionDigits had totalDigits. Only unsignedLong still have maxInclusive instead of totalDigits because of a bug in JAXB XJC (715).

  * Most numeric elements don't have a maxInclusive facet anymore (they were serving the purpose of totalDigits). The only exception is unsignedLong.

  * Most numeric elements don't have a minInclusive facet anymore. Exceptions are xsd:integer and xsd:decimal when they are unsigned. In these cases, minInclusive is used to enforce the positive character of the numeric. For decimals, the minInclusive value is not "0.0" anymore but simply "0".

  * xsd:string and xsd:hexBinary now use the maxLength facet instead of the length. There is no reason to force a fixed length since the COBOL binder is perfectly capable of filling the void with spaces or low-values.

  * level 88 are mapped to XML schema enumeration facets or minInclusive/maxInclusive. This is turned off by default because COBOL level 88 are not allways meant as restrictions on the content. Relevant option is [setMapConditionsToFacets](http://www.legsem.com/legstar/legstar-cob2xsd/apidocs/com/legstar/cob2xsd/Cob2XsdModel.html#setMapConditionsToFacets(boolean)).

  * minOccurs and maxOccurs are now omitted when they have the default value 1.

  * LegStar annotations are not generated by default. To get the annotations, you need to turn on the [setAddLegStarAnnotations](http://www.legsem.com/legstar/legstar-cob2xsd/apidocs/com/legstar/cob2xsd/Cob2XsdModel.html#setAddLegStarAnnotations(boolean)) option.

  * For LegStar annotations, attribute usage='DISPLAY' is now omitted, unless explicit in the COBOL source.

  * For LegStar annotations, attribute levelNumber does not have leading zeroes anymore: levelNumber="05" becomes levelNumber="5".

  * For LegStar annotations, srceLine attribute is sometimes different because legstar-schemagen used the last clause line while legstar-cob2xsd uses the line on which the clause starts.

  * For LegStar annotations, cobolName attribute is FILLER if the data item is a filler. legstar-schemagen used FILLER-srceLine instead.

  * The default COBOL compiler QUOTE option is now QUOTE (it is APOST for legstar-schemagen). You can revert this by setting option [setQuoteIsQuote](http://www.legsem.com/legstar/legstar-cob2xsd/apidocs/com/legstar/cob2xsd/Cob2XsdModel.html#setQuoteIsQuote(boolean)) to false.
